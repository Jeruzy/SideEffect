mkdir("Test")
q()
q()
library("tidyr")
library("dplyr")
library("ChemmineR")
installed.packages("tidyverse")
install.packages("ChemmineR")
setRepositories()
install.packages("ChemmineR")
library("ChemmineR")
if (!requireNamespace("BiocManager", quietly=TRUE))
install.packages("BiocManager")
BiocManager::install("ChemmineR")
library("ChemmineR")
install.packages("glue")
library("ChemmineR")
install.packages("ChemminOB")
install.packages("ChemmineOB")
find_rtools()
install.packages("devtools")
library(devtools)
find_rtools()
find_rtools()
library("tidyr")
library("dplyr")
source("C:/Users/Samsung/source/repos/R/Side_effects/functions.R")
drug_names <- readr::read_tsv("Data/drug_names.tsv", col_names = c("stitch_id_flat","drug_name"))
getWD()
getwd()
setwd("C:/Users/Samsung/source/repos/R/Side_effects")
drug_names <- readr::read_tsv("Data/drug_names.tsv", col_names = c("stitch_id_flat","drug_name"))
meddra_freq <- readr::read_tsv("Data/meddra_freq.tsv", col_names =c('stitch_id_flat',
'stitch_id_sterio',
'umls_cui_from_label',
'placebo',
'frequency',
'lower',
'upper',
'meddra_type',
'umls_cui_from_meddra',
'side_effect_name'))
tibble::add_column(drug_names, pubchem_id = "")
for (id in drug_names[1]) {
drug_names$pubchem_id <- stringr::str_replace(id, "(CID[10]0*)","")
}
drug_names_inchi <- readr::read_tsv("Data/drugs_with_inchi.tsv")
meddra_freq_cleaned <- meddra_freq %>%
dplyr::select(stitch_id_flat,frequency,meddra_type,side_effect_name,lower)
View(meddra_freq_cleaned)
meddra_freq_cleaned <- dplyr::left_join(meddra_freq_cleaned, drug_names_inchi, by="stitch_id_flat")
meddra_freq_cleaned <- meddra_freq_cleaned %>% select(-row_num)
meddra_freq_cleaned <- meddra_freq_cleaned %>%
dplyr::filter(meddra_type != "LLT") %>%
dplyr::filter(lower >= 0.1)
meddra_freq_cleaned <- meddra_freq_cleaned %>%
dplyr::filter(!frequency %in% c("rare", "very rare", "uncommon", "postmarketing","infrequent"))
View(drug_names_inchi)
for(i in drug_names$inchi)
{
drug_names_inchi$sdf <- ChemmineOB::convertFormat("INCHI","SDF",i)
}
warnings()
for(i in drug_names_inchi$inChi)
{
drug_names_inchi$sdf <- ChemmineOB::convertFormat("INCHI","SDF",i)
}
View(drug_names_inchi)
drug_names_inchi$sdf <- "NA"
for(i in drug_names_inchi$InChi)
{
drug_names_inchi$sdf <- ChemmineOB::convertFormat("INCHI","SDF",i)
}
obabel -L formats
for(i in drug_names_inchi$InChi)
{
drug_names_inchi$sdf <- ChemmineOB::convertFormat("INCHI","SDF",i,options=data.frame(names ="gen2d",args=""))
}
for(i in drug_names_inchi$InChi)
{
drug_names_inchi$sdf <- ChemmineOB::convertFormat("InCHI","SDF",i,options=data.frame(names ="gen2d",args=""))
}
install.packages("webchem")
library("webchem")
drug_names_inchi&smiles <- "NA"
for(i in drug_names_inchi$InChi)
{
drug_names_inchi$smiles <- webchem::cs_inchi_smiles(i)
}
View(get_inchi)
for(i in drug_names_inchi$InChi)
{
drug_names_inchi$smiles <- ChemmineOB::convertFormat("inchi","sdf",i,options = data.frame(names="gen2d"))
}
readr::write_lines(drug_names_inchi$pubchem_id,"bulk_cid.txt")
install.packages("Rchemcpp")
install.packages("Rchemcpp")
getwd()
sdfSet <- ChemmineR::read.SDFset("/Data/compounds.sdf")
getwd()
ls
ls()
sdfSet <- ChemmineR::read.SDFset("/compounds.sdf")
sdfSet <- ChemmineR::read.SDFset("C:\Users\Samsung\source\repos\R\Side_effects\Data\compounds.sdf")
sdfSet <- ChemmineR::read.SDFstr("Data/compounds.sdf")
rm(sdfSet)
sdfstr <- ChemmineR::read.SDFstr("Data/compounds.sdf")
sdfstr <- as(sdfSet, "SDFstr")
sdfstr <- ChemmineR::read.SDFset("Data/compounds.sdf")
rm(sdfstr)
sdfset <- ChemmineR::read.SDFset("Data/compounds.sdf")
valid <- ChemmineR::validSDF(sdfset)
sdfset <- sfset[valid]
sdfset <- sdfset[valid]
View(sdfset)
apset <- ChemmineR::sdf2ap(sdfset)
warnings()
which(sapply(as(apset, "list"), length)==1
)
save(apset, file = "apset.rda", compress = TRUE)
load("apset.rda")
cmp.similarity(apset[1],apset[1])
cmp.similarity(apset[1],apset[2])
View(apset)
cmp.similarity(apset["85"],apset["85"])
cmp.search(apset,apset["85", type =3, cutoff 0.3, quiet = TRUE])
cmp.search(apset,apset["85"], type =3, cutoff 0.3, quiet = TRUE)
cmp.search(apset,apset["85"], type =3, cutoff = 0.3, quiet = TRUE)
load("sdfset.rda")
save(sdfset, file = "sdfset.rda", compress = TRUE)
load("sdfset.rda")
View(sdfset)
cmp.search(apset,apset["244"], type =3, cutoff = 0.3, quiet = TRUE)
cmp.search(apset,apset[1], type =3, cutoff = 0.3, quiet = TRUE)
view(apset[1:4])
ChemmineR:cmp.search(sdset,["85"])
ChemmineR:cmp.search(sdset,sdset["85"])
ChemmineR::cmp.search(sdset,sdset["85"])
ChemmineR::cmp.search(sdfset,sdfset["85"])
apset <- ChemmineR::sdf2ap(sdfset)
View(sdfset)
cmp.search(apset,apset["CMP1"], type =3, cutoff = 0.3, quiet = TRUE)
cid(sdfset[1:4])
cids_valid <- drug_names$pubchem_id[valid]
typeof(sdfset)
View(sdfset)
sdfset@ID
sdfset@ID <- cids_valid
View(sdfset)
apset <- ChemmineR::sdf2ap(sdfset)
save(sdfset, file = "sdfset.rda", compress = TRUE)
save(apset, file = "apset.rda", compress = TRUE)
load("apset.rda")
cmp.search(apset,apset["85"], type =3, cutoff 0.3, quiet = TRUE)
cmp.search(apset,apset["85"], type =3, cutoff = 0.3, quiet = TRUE)
View(meddra_freq_cleaned)
len(unique(meddra_freq_cleaned$pubchem_id))
length(unique(meddra_freq_cleaned$pubchem_id))
length(unique(meddra_freq_cleaned$side_effect_name))
length(unique(drug_names$pubchem_id))
unique_cids <- unique(meddra_freq_cleaned$pubchem_id)
sdfset_valid <- sdfset[sdfset@ID %in% unique_cids,]
View(sdfset_valid)
save(sdfset_valid, file = "sdfset_valid.rda", compress = TRUE)
apset_valid <- sdf2ap(sdfset_valid)
save(sdfset_valid, file = "sdf_valid.sdf")
save(apset_valid, file ="apset_valid.rda", compress = TRUE)
load("apset_valid.rda")
rm(apset)
cmp_sim_df <- data.frame(matrix(ncol = 700, nrow = 700))
col_names(cmp_sim_df) <- unique_cids
colnames(cmp_sim_df) <- unique_cids
View(cmp_sim_df)
rownames(cmp_sim_df) <- unique_cids
View(apset_valid)
rownames(cmp_sim_df[1])
rownames(cmp_sim_df[1,1])
rownames(cmp_sim_df[1,])
rownames(cmp_sim_df[,1])
colnames(cmp_sim_df[,1])
colnames(cmp_sim_df[1,])
colnames(cmp_sim_df[,1])
colnames(cmp_sim_df[,2])
colnames(cmp_sim_df[,1])
colnames(cmp_sim_df) <- unique_cids
rownames(cmp_sim_df) <- unique_cids
colnames(cmp_simd_df)
colnames(cmp_sim_df)
colnames(cmp_sim_df[,1])
colnames(cmp_sim_df[1,])
colnames(cmp_sim_df[1,1])
colnames(cmp_sim_df[,1])
colnames(cmp_sim_df[1])
rownames(cmp_sim_df[1])
rownames(cmp_sim_df[1,])
for(i in 1:ncol(cmp_sim_df))
{
for(j in 1:nrow(cmp_sim_df))
{
cmp_sim_df[i,j] <- cmp.similarity(apset_valid[rownames(cmp_sim_df[i,])], apset_valid[colnames(cmp_sim_df[j])])
}
}
row_number(cmp_sim_df)
row_number(cmp_sim_df["6436"])
which(rownames(cmp_sim_df) == "6436")
for(i in 1:ncol(cmp_sim_df))
{
for(j in 368:nrow(cmp_sim_df))
{
cmp_sim_df[i,j] <- cmp.similarity(apset_valid[rownames(cmp_sim_df[i,])], apset_valid[colnames(cmp_sim_df[j])])
}
}
cmp.similarity(apset_valid["143"], apset_valid["137"])
install.packages("ggplot")
install.packages("ggplot2")
plot(heatmap(cmp_sim_df))
heat <- plot(heatmap(cmp_sim_df))
heat <- plot(heatmap(as.matrix(cmp_sim_df)))
show(heat)
?heat
?heatmap
typeof(cmp_sim_df)
is.matrix(as.matrix(cmp_sim_df))
is.matrix(matrix(cmp_sim_df))
sim_matrix <- matrix(cmp_sim_df)
sim_heat <- heatmap(sim_matrix)
a
show(sim_heat)
plot(sim_heat)
sim_heat <- heatmap(sim_matrix)
typeof(sim_matrix)
sim_matrix <- as.matrix(cmp_sim_df)
typeof(sim_matrix)
sim_heat <- heatmap(sim_matrix)
a
plot(sim_heat)
show(sim_heat)
sim_heat
cmp.search(apset_valid,"54677977")
cmp.search(apset_valid,apset_valid["54677977"])
View(sim_heat)
install.packages("RColorBrewer")
librar("RColorBrewer")
library("RColorBrewer")
sim_heat <- heatmap(sim_matrix, scale = "column")
sim_heat
View(meddra_freq_cleaned)
cmp_long <- cmp_sim_df %>%
tibble::rownames_to_column()
cmp_long <- tibble::rownames_to_column(cmp_sim_df)
View(cmp_long)
cmp_long <- cmp_long %>%
tidyr::gather(key = "Destination", value = "similarity",-rowname)
library("tidyr")
library("dplyr")
cmp_long <- cmp_long %>%
tidyr::gather(key = "Destination", value = "similarity",-rowname)
cmp_long$Directoin <- "undirected"
cmp_long %>% dplyr::rename(rownname = Source)
cmp_long %>% dplyr::rename(rowname = Source)
cmp_long %>% dplyr::rename(Source = rowname)
cmp_long %>% dplyr::rename(Direction = Directoin)
readr::write_tsv(cmp_long, "Data/PID_Similarity.tsv")
View(drug_names)
View(cmp_long)
cmp_node <- dplyr::left_join(cmp_long,drug_names, by=c("Source","pubchem_id"))
cmp_node <- dplyr::left_join(cmp_long,drug_names, by=c("Source" = "pubchem_id"))
View(cmp_long)
cmp_long %>% dplyr::rename(Source = rowname)
cmp_long %>% dplyr::rename(Direction = Directoin)
View(cmp_long)
cmp_long <- cmp_long %>% dplyr::rename(Source = rowname)
cmp_long <- cmp_long %>% dplyr::rename(Direction = Directoin)
cmp_node <- dplyr::left_join(cmp_long,drug_names, by=c("Source" = "pubchem_id"))
View(cmp_node)
cmp_node <- dplyr::left_join(cmp_long,drug_names, by=c("Source" = "pubchem_id")) %>%
dplyr::select(Source,drug_name) %>%
dplyr::distinct()
readr::write_tsv(cmp_node, "Data/PID_Node.tsv")
readr::write_tsv(cmp_long, "Data/PID_Similarity.tsv")
View(cmp_long)
cmp_long[is.na(cmp_long)] <- 0
readr::write_tsv(cmp_long, "Data/PID_Similarity.tsv")
View(cmp_long)
View(cmp_node)
View(drug_names_inchi)
View(cmp_node)
View(cmp_node)
duplicated(cmp_node)
cid_inchi <- drug_names_inchi %>%
select(pubchem_id, InChi) %>%
left_join(drug_names_inchi, by=pubchem_id) %>%
select(pubchem_id, InChi)
View(drug_names_inchi)
cid_inchi <- drug_names_inchi %>%
select(pubchem_id, InChi)
View(cid_inchi)
View(cmp_node)
cid_inchi <- left_join(cid_inchi, cmp_node, by="pubchem_id=Source")
View(cid_inchi)
cid_inchi <- left_join(cid_inchi, cmp_node, by=c("pubchem_id"="Source"))
View(cmp_node)
cmp_node$Source <-  as.integer(cmp_node$Source)
cid_inchi <- left_join(cid_inchi, cmp_node, by=c("pubchem_id"="Source"))
View(cid_inchi)
cid_inchi <- drug_names_inchi %>%
select(pubchem_id, InChi)
cid_inchi <- left_join(cmp_node, cid_inchi, by=c("pubchem_id"="Source"))
cid_inchi <- left_join(cmp_node, cid_inchi, by=c("Source"="pubchem_id"))
View(cid_inchi)
readr::write_tsv(cid_inchi, "Data/cid_inchi.tsv")
View(cid_inchi)
cid_inchi$InChi[1]
cid_inchi$InChi <- stringr::str_replace_all(cid_inchi$inchi,"[\r\n]","")
cid_inchi$InChi <- stringr::str_replace_all(cid_inchi$InChi,"[\r\n]","")
cid_inchi$InChi[1]
readr::write_tsv(cid_inchi, "Data/cid_inchi.tsv")
View(cmp_long)
View(meddra_freq_cleaned)
ae_df <- meddra_freq_cleaned %>%
select(pubchem_id, side_effect_name,lower)
View(ae_df)
ae_df_spread <- ae_df %>%
spread(key = side_effect_name, value = lower)
ae_df_spread <- ae_df %>%
spread(key = side_effect_name, value = lower, fill = 0)
ae_df_spread <- ae_df %>%
mutate(id = row_number())
View(ae_df_spread)
ae_df_spread <- ae_df %>%
mutate(id = row_number()) %>%
spread(side_effect_name,lower,fill = 0)
View(ae_df_spread)
ae_df_spread <ae_df_spread %>%
select(-id)
View(ae_df_spread)
(-id)
View(ae_df_spread)
ae_df_spread <- ae_df_spread %>%
select(-id)
typeof(ae_df_spread$pubchem_id)
View(ae_df_spread)
ae_df_spread$pubchem_id <- as.character(ae_df_spread$pubchem_id)
round(0.3,1)
round(0.3,digits = 1)
ae_df_spread <- ae_df_spread %>%
group_by(pubchem_id) %>%
summarise_all(mean())
ae_df_spread <- ae_df_spread %>%
group_by(pubchem_id) %>%
summarise_all(mean(.))
ae_df_spread <- ae_df_spread %>%
group_by(pubchem_id) %>%
summarise_all(funs(mean))
ae_df_spread$pubchem_id["85"]
ae_df_spread$pubchem_id["9966051"]
ae_df_spread$pubchem_id[85]
ae_df_spread$pubchem_id`85`
"85" %in% ae_df_spread$pubchem_id
ae_df_spread[,-1] <- (ae_df_spread[,-1] != 0)*1
View(meddra_freq_cleaned)
View(meddra_freq)
View(meddra_freq_cleaned)
ae_df_spread$pubchem_id <-as.numeric(ae_df_spread$pubchem_id)
TRUE * 1
